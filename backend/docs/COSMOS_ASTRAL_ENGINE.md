# Cosmos Astral Engine - Sistema de Valida√ß√£o Matem√°tica

## üìã Vis√£o Geral

O **Cosmos Astral Engine** √© o novo sistema de gera√ß√£o de mapas astrais que integra:

1. **Valida√ß√£o Matem√°tica Rigorosa** - Verifica√ß√£o astron√¥mica antes de qualquer interpreta√ß√£o
2. **Interpreta√ß√£o Profunda** - An√°lise psicol√≥gica e evolutiva baseada apenas em dados validados
3. **S√≠ntese Avan√ßada** - M√∫ltiplas camadas de refinamento para evitar descri√ß√µes superficiais

---

## üî¨ PASSO 1: Motor de Valida√ß√£o

### 1.1 Regras de Ouro da Astronomia (Travas de Seguran√ßa)

O sistema **PROIBE** interpreta√ß√µes que violam limites astron√¥micos reais:

#### Limites de Dist√¢ncia entre Planetas:

- **Merc√∫rio x Sol:** M√°ximo 28¬∞
  - ‚úÖ Permitido: Conjun√ß√£o (0-10¬∞) ou Sem Aspecto
  - ‚ùå Proibido: Quadratura (90¬∞), Tr√≠gono (120¬∞), Oposi√ß√£o (180¬∞), Sextil (60¬∞)

- **V√™nus x Sol:** M√°ximo 48¬∞
  - ‚úÖ Permitido: Conjun√ß√£o (0-10¬∞), Semi-Sextil (30¬∞), Semi-Quadratura (45¬∞)
  - ‚ùå Proibido: Sextil (60¬∞), Quadratura (90¬∞), Tr√≠gono (120¬∞), Oposi√ß√£o (180¬∞)

- **V√™nus x Merc√∫rio:** M√°ximo 76¬∞
  - ‚úÖ Permitido: Conjun√ß√£o, Sextil
  - ‚ùå Proibido: Quadratura, Tr√≠gono, Oposi√ß√£o

### 1.2 C√°lculo Real de Aspectos (Geometria Sagrada)

Tabela rigorosa de orbes para valida√ß√£o:

| Aspecto | √Çngulo Ideal | Orbe Permitido | Dist√¢ncia V√°lida |
|---------|--------------|----------------|------------------|
| Conjun√ß√£o | 0¬∞ | ¬±8¬∞ | 0¬∞-8¬∞ ou 352¬∞-360¬∞ |
| Sextil | 60¬∞ | ¬±4¬∞ | 56¬∞-64¬∞ (Harm√¥nico) |
| Quadratura | 90¬∞ | ¬±6¬∞ | 84¬∞-96¬∞ (Tenso) |
| Tr√≠gono | 120¬∞ | ¬±8¬∞ | 112¬∞-128¬∞ (Fluido) |
| Oposi√ß√£o | 180¬∞ | ¬±8¬∞ | 172¬∞-188¬∞ (Tenso) |
| Quinc√∫ncio | 150¬∞ | ¬±2¬∞ | 148¬∞-152¬∞ (Ajuste) |

> **Regra Cr√≠tica:** Se a dist√¢ncia for, por exemplo, 65¬∞ (Le√£o para Libra), √© um Sextil "largo" ou Sem Aspecto. **JAMAIS** chamar isso de Oposi√ß√£o ou Quadratura. Respeitar a geometria sempre.

### 1.3 C√°lculo de Temperamento (Algoritmo de Pesos)

**Sistema de Pontua√ß√£o:**
- Sol/Lua/Ascendente = **3 pontos cada**
- Outros planetas (Merc√∫rio a Plut√£o) = **1 ponto cada**

**Regra de Interpreta√ß√£o:** Se o usu√°rio tem Lua, Marte e V√™nus em signos de Fogo, **N√ÉO PODE** dizer que o elemento Fogo est√° "ausente" ou √© "ponto cego". Verificar os dados sempre.

---

## üìù PASSO 2: Diretrizes de Interpreta√ß√£o

### Tom de Voz
- **Anal√≠tico e Emp√°tico:** L√≥gica para explicar, empatia para aconselhar
- **Evolutivo:** Foco em "Para que serve?" n√£o apenas "Como voc√™ √©"
- **N√£o Determinista:** Usar "tende a", "pode sentir", "desafio de aprendizado"

### Estrutura do Relat√≥rio
1. Dados T√©cnicos Validados
2. An√°lise de Temperamento (baseada em c√°lculo real)
3. A Tr√≠ade Primordial (Sol, Lua, Asc)
4. Mec√¢nica de Decis√£o (Merc√∫rio e Marte)
5. Afetividade (V√™nus e Lua)
6. Desafios e Karma (Saturno, Nodos, Qu√≠ron)

---

## üß† PASSO 3: L√≥gica de S√≠ntese Avan√ßada

### 3.1 Verifica√ß√£o de Dignidades Essenciais

Antes de interpretar, verificar o "estado de √¢nimo" c√≥smico:

- **Domic√≠lio:** Planeta em casa (ex: Marte em √Åries/Escorpi√£o)
  - Energia flui pura, forte e natural

- **Exalta√ß√£o:** Planeta convidado de honra (ex: Sol em √Åries)
  - Energia opera em melhor performance (talvez exagerada)

- **Detrimento:** Planeta no signo oposto ao domic√≠lio (ex: Marte em Libra)
  - Energia desconfort√°vel, precisa agir de forma indireta

- **Queda:** Planeta no signo oposto √† exalta√ß√£o (ex: Sol em Libra)
  - Planeta se sente inadequado, precisa muito esfor√ßo

- **Peregrino:** Sem dignidade ou debilidade forte
  - Depende dos aspectos que recebe de outros

### 3.2 A Regra da Reg√™ncia

Para interpretar uma Casa, **OBRIGATORIAMENTE** olhar onde est√° o Regente:

**L√≥gica:**
1. Identificar signo da c√∫spide da Casa X
2. Identificar Planeta Regente desse signo
3. Ver em que Casa Y esse planeta est√°

**Template:** "A √°rea da sua vida sobre [Assunto da Casa X] est√° diretamente ligada a [Assunto da Casa Y], pois o regente est√° l√°."

### 3.3 Gest√£o de Contradi√ß√µes

Humanos s√£o contradit√≥rios. Se o mapa mostrar aspectos conflitantes, **N√ÉO ignorar**. Sintetizar sempre.

**Exemplo:** Sol em Libra (paz) vs. Lua em Le√£o (drama/aten√ß√£o)
- **S√≠ntese:** "Existe um conflito interno: parte racional deseja harmonia (Sol), necessidade emocional visceral de ser notado (Lua). Crescimento depende de aprender a brilhar (Le√£o) sem quebrar a diplomacia (Libra)."

---

## üéØ PASSO 4: M√≥dulos Tem√°ticos Espec√≠ficos

### M√≥dulo A: Intelig√™ncia e Comunica√ß√£o (Merc√∫rio)
- **Ar:** Processamento l√≥gico, social, pode ser indeciso
- **Fogo:** Intui√ß√£o r√°pida, fala antes de pensar
- **Terra:** Pr√°tico, lento, met√≥dico, focado em resultados
- **√Ågua:** Mem√≥ria fotogr√°fica, decide pelo "feeling"

### M√≥dulo B: Din√¢mica do Desejo (V√™nus e Marte)
- **V√™nus:** O que valoriza e como atrai
- **Marte:** Como conquista e briga
- **S√≠ntese:** "Voc√™ busca [Estilo V√™nus], mas age de forma [Estilo Marte]."

### M√≥dulo C: Voca√ß√£o e Carreira (Meio do C√©u)
- Analisar Signo do MC, planetas na Casa 10, Saturno
- Diferenciar "Trabalho Rotineiro" (C6) de "Legado/Carreira" (C10)

---

## üí° PASSO 5: Remedia√ß√£o e Conselho Evolutivo

Para cada tens√£o identificada, fornecer "Mecanismo de Sa√≠da". **N√ÉO entregar fatalismo.**

**Exemplo:**

**Problema:** "Saturno em oposi√ß√£o a Marte (Freio vs. Acelerador)."

**‚ùå Ruim:** "Voc√™ nunca vai conseguir agir."

**‚úÖ Bom:** "Para vencer essa tens√£o, use a estrat√©gia do 'Passo Calculado'. Use a disciplina de Saturno para planejar a a√ß√£o de Marte. Transforme a impulsividade em resist√™ncia de longo prazo. Esportes de resist√™ncia ajudam a canalizar essa energia."

---

## üìê Formata√ß√£o Final

- **Negrito** para conceitos chave e posi√ß√µes planet√°rias
- *It√°lico* para nuances psicol√≥gicas
- Listas (Bullet points) para facilitar leitura
- **Frase de Poder:** Mantra curto que sintetiza a miss√£o do mapa

**Exemplo:** "Sua miss√£o √© liderar com o cora√ß√£o, mas planejar com a mente."

---

## ‚úÖ Instru√ß√£o Final

1. Processar dados de nascimento fornecidos
2. Fazer valida√ß√£o astron√¥mica silenciosa
3. Gerar relat√≥rio baseado em dados validados
4. Se encontrar aspectos imposs√≠veis, ignorar e interpretar apenas signo/casa, ou alertar que configura√ß√£o √© astronomicamente rara

---

## üìÑ Arquivos Modificados

- `backend/app/api/interpretation.py`
  - Fun√ß√£o `_get_master_prompt()` completamente reescrita
  - Novo sistema Cosmos Astral Engine implementado
  - Removidas men√ß√µes a "IA" ou "gerado por IA"
  - Foco em c√°lculo matem√°tico e valida√ß√£o astron√¥mica

---

**Data de Implementa√ß√£o:** 30/11/2025  
**Status:** ‚úÖ Implementado e Funcionando

